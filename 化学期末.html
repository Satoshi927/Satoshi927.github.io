<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>化学 共通テスト/演習問題クイズ</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --bg-color: #f5f7fa;
            --text-color: #333;
        }

        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden; /* アニメーションのはみ出し防止 */
        }

        .container {
            background: white;
            max-width: 800px;
            width: 100%;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            z-index: 10; /* アニメーションより手前に */
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 1.8rem;
        }

        /* スタート画面 */
        .start-menu {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .mode-btn {
            background-color: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            transition: all 0.2s;
            font-weight: bold;
        }

        .mode-btn:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3);
        }

        /* クイズ画面 */
        .progress-bar {
            width: 100%;
            background-color: #eee;
            border-radius: 10px;
            margin-bottom: 20px;
            height: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-box {
            font-size: 1.1rem;
            margin-bottom: 25px;
            line-height: 1.6;
            font-weight: bold;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }

        .options-grid {
            display: grid;
            gap: 12px;
        }

        .option-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            text-align: left;
            transition: all 0.2s;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            background-color: #eef5ff;
            border-color: var(--primary-color);
        }

        .option-btn.correct {
            background-color: #d4edda;
            border-color: var(--success-color);
            color: #155724;
        }

        .option-btn.wrong {
            background-color: #f8d7da;
            border-color: var(--error-color);
            color: #721c24;
        }

        /* 解説エリア */
        .explanation-area {
            display: none;
            margin-top: 25px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid var(--primary-color);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .explanation-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: block;
        }

        .mnemonic-box {
            margin-top: 15px;
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            color: #856404;
            font-weight: bold;
        }

        .next-btn, .retry-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
            display: block;
            width: 100%;
            transition: background 0.2s;
        }

        .next-btn:hover, .retry-btn:hover {
            background-color: #357abd;
        }

        /* 結果画面 */
        .result-screen {
            text-align: center;
            display: none;
        }
        
        .score-display {
            font-size: 2rem;
            margin: 20px 0;
            color: var(--primary-color);
        }

        /* =========================================
           ここから新しいアニメーション用CSS
           ========================================= */
        
        /* 全画面を覆うコンテナ（クリック不可） */
        .anim-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* 正解の〇 (下から飛び出す) */
        .symbol-correct {
            font-size: 15rem;
            color: var(--success-color);
            font-weight: 900;
            text-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
            animation: shootUpBounce 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes shootUpBounce {
            0% {
                transform: translateY(100vh) scale(0.5);
                opacity: 0;
            }
            60% {
                transform: translateY(-20px) scale(1.1);
                opacity: 1;
            }
            80% {
                transform: translateY(10px) scale(0.95);
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 0; /* 最後はフェードアウト */
            }
        }

        /* 不正解の✕ (ズームインして揺れる) */
        .symbol-wrong {
            font-size: 15rem;
            color: var(--error-color);
            font-weight: 900;
            text-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            animation: zoomShake 0.8s ease forwards;
        }

        @keyframes zoomShake {
            0% { transform: scale(3); opacity: 0; }
            40% { transform: scale(1); opacity: 1; }
            50% { transform: rotate(-10deg); }
            60% { transform: rotate(10deg); }
            70% { transform: rotate(-10deg); }
            100% { transform: scale(1) rotate(0); opacity: 0; }
        }

        /* 紙吹雪（パーティクル） */
        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: confettiFall 1.5s ease-out forwards;
        }

        @keyframes confettiFall {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }

    </style>
</head>
<body>

<div class="container">
    <!-- スタート画面 -->
    <div id="start-screen">
        <h1>化学 演習クイズ</h1>
        <div class="start-menu">
            <button class="mode-btn" onclick="startQuiz('normal')">順番通りにスタート</button>
            <button class="mode-btn" onclick="startQuiz('shuffle')">シャッフルしてスタート</button>
        </div>
    </div>

    <!-- クイズ画面 -->
    <div id="quiz-screen" style="display: none;">
        <h1 id="quiz-header">問題</h1>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="question-box" id="question-text">
            問題文読み込み中...
        </div>
        <div class="options-grid" id="options-container">
            <!-- 選択肢がここに入ります -->
        </div>

        <div class="explanation-area" id="explanation-area">
            <span class="explanation-title">【解説】</span>
            <div id="explanation-text"></div>
            <div class="mnemonic-box" id="mnemonic-text"></div>
            <button class="next-btn" id="next-btn" onclick="nextQuestion()">次の問題へ</button>
        </div>
    </div>

    <!-- 結果画面 -->
    <div id="result-screen" class="result-screen">
        <h1>結果発表</h1>
        <div class="score-display" id="score-display"></div>
        <p id="result-message"></p>
        <button class="retry-btn" id="retry-wrong-btn" onclick="retryWrong()" style="display:none;">間違えた問題をやり直す</button>
        <button class="retry-btn" onclick="location.reload()" style="background-color: #6c757d; margin-top: 10px;">タイトルに戻る</button>
    </div>
</div>

<script>
    // 問題データ
    const problems = [
        {
            id: 1,
            text: "鉄に関する記述として誤りを含むものはどれか。",
            options: [
                "① 鉄を亜鉛でめっきすると，鉄は腐食しにくくなる。",
                "② 鉄(III)イオンを含む水溶液に，チオシアン酸カリウム水溶液を加えると，血赤色の溶液になる。",
                "③ 鉄(III)イオンを含む水溶液に，K₃[Fe(CN)₆]の水溶液を加えると，濃青色の沈殿を生じる。",
                "④ 鉄にクロムやニッケルを混ぜてつくった合金はステンレス鋼という。"
            ],
            correct: 2, 
            explanation: "Fe³⁺ と K₃[Fe(CN)₆]（酸化数+3の錯体）の組み合わせでは、お互いに酸化数が同じなので濃青色沈殿は生じず、褐色の溶液になります。濃青色沈殿ができるのは酸化数が違うときです。",
            mnemonic: "覚え方：「3と3は混ざらない（褐色）、2と3で青くなる」"
        },
        {
            id: 2,
            text: "有機化合物の反応に関する記述として誤りを含むものはどれか。",
            options: [
                "① 酢酸ナトリウムと水酸化ナトリウムの混合物を加熱すると，メタンが発生する。",
                "② アセトアルデヒドは，工業的には触媒を用いてエチレンを酸素で酸化して製造している。",
                "③ エタノールにナトリウムを加えると，ナトリウムエトキシドが得られる。",
                "④ シクロヘキサンに水素を付加させると，シクロヘキセンが得られる。",
                "⑤ メタノールは工業的に，一酸化炭素と水素から製造される。"
            ],
            correct: 3, 
            explanation: "シクロヘキサン（C₆H₁₂）はすでに水素で満タン（飽和）の状態です。これ以上水素を付加することはできません。逆にシクロヘキセンに水素を付加するとシクロヘキサンになります。",
            mnemonic: "覚え方：「満腹（飽和）のヘキサンに、水素のおかわりは無理！」"
        },
        {
            id: 3,
            text: "互いに同素体の関係にあるものはどれか。",
            options: [
                "① 金と白金",
                "② ナトリウムとカリウム",
                "③ 一酸化炭素と二酸化炭素",
                "④ 黄リンと赤リン",
                "⑤ ¹²C と ¹³C"
            ],
            correct: 3, 
            explanation: "同素体は「同じ元素からなる単体」です。黄リンと赤リンは共にリン（P）の同素体です。①②は別元素、③は化合物、⑤は同位体です。",
            mnemonic: "覚え方：同素体はSCOP（スコップ）。硫黄、炭素、酸素、リン。"
        },
        {
            id: 4,
            text: "ベンゼンに関する記述として誤りを含むものはどれか。",
            options: [
                "① ベンゼンの炭素間距離はすべて等しい。",
                "② ベンゼンを空気中で燃やすと，多量のすすが生じる。",
                "③ ベンゼン分子中のすべての原子は，同一平面上にある。",
                "④ ベンゼンは常温・常圧で無色の液体である。",
                "⑤ ベンゼンは水に溶けにくく，水より重い。"
            ],
            correct: 4, 
            explanation: "ベンゼンは炭化水素（油の仲間）であり、水よりも密度が小さく（軽く）、水に浮きます。",
            mnemonic: "覚え方：「ベンゼンは油の仲間、水にプカプカ浮く（軽い）」"
        },
        {
            id: 5,
            text: "ゴムに関する記述として誤りを含むものはどれか。",
            options: [
                "① 非結晶部分（無定形部分）のみからなる。",
                "② 天然ゴム（生ゴム）を空気中に長時間放置するとゴム弾性を失う。",
                "③ スチレンーブタジエンゴム（SBR）は，炭素間の二重結合とベンゼン環を含んでいる。",
                "④ 天然ゴム（生ゴム）に数 ％ の硫黄を加えると，硫黄原子の架橋構造ができる。",
                "⑤ 天然ゴム（生ゴム）のポリイソプレンに含まれる二重結合には，シス形とトランス形がほぼ同じ割合で存在する。"
            ],
            correct: 4, 
            explanation: "天然ゴムは、ほぼ100%が「シス形」のポリイソプレンです。トランス形はグッタペルカという別の物質になります。",
            mnemonic: "覚え方：「天然ゴムは、シス（Systematic）に並んで柔らかい」"
        },
        {
            id: 6,
            text: "金属結晶に関する記述として誤りを含むものはどれか。",
            options: [
                "① アルカリ金属の単体の結晶では，原子番号が大きいほど融点が低くなる。",
                "② 六方最密構造と面心立方格子の配位数は，ともに12である。",
                "③ 体心立方格子の構造をもつ金属結晶の密度と面心立方格子の構造をもつ金属結晶の密度を比べると，必ず面心立方格子の構造をもつ金属結晶の方が大きい。",
                "④ 銀は，すべての金属のうちで最も電気伝導性が大きい。"
            ],
            correct: 2, 
            explanation: "密度は格子の種類だけでなく、原子量（原子の重さ）にも依存します。たとえスカスカな構造でも原子自体が重ければ密度は高くなるため、「必ず面心の方が大きい」とは言えません。",
            mnemonic: "覚え方：「密度は並び方だけじゃ決まらない。体重（原子量）も大事！」"
        },
        {
            id: 7,
            text: "貴ガスに関する記述として誤りを含むものはどれか。",
            options: [
                "① 他の原子とはほとんど化合物をつくらない。",
                "② 単体の沸点は，原子量が大きい方が高い。",
                "③ 空気中で最も多く存在するのは，ネオンである。",
                "④ ヘリウムは，気球などに用いられる。",
                "⑤ アルゴンは，蛍光灯に封入されている。"
            ],
            correct: 2, 
            explanation: "空気中に最も多く存在する貴ガスは「アルゴン（Ar）」です（約1%）。ネオンではありません。",
            mnemonic: "覚え方：「空気の中には窒素、酸素、あるごん（Ar）！」"
        },
        {
            id: 8,
            text: "クロム酸イオンに関する記述として誤りを含むものはどれか。",
            options: [
                "① クロム原子の酸化数は，+6である。",
                "② 水溶液は，黄色である。",
                "③ 水溶液に希硫酸を加えると，二クロム酸イオン Cr₂O₇²⁻ が生成する。",
                "④ 強い酸化作用を示すため，酸化還元滴定に用いられる。"
            ],
            correct: 3, 
            explanation: "酸化還元滴定で強力な酸化剤として使われるのは、赤橙色の「二クロム酸イオン（Cr₂O₇²⁻）」です。クロム酸イオンではありません。",
            mnemonic: "覚え方：「滴定で暴れる（酸化する）のは、オレンジ色のニクロム酸」"
        },
        {
            id: 9,
            text: "エネルギーに関する記述として下線部に誤りを含むものはどれか。",
            options: [
                "① 電子親和力とは，気体状態の原子が電子1個を取り込んだ際に放出されるエネルギーである。",
                "② 0℃において，1 mol の氷が融解する際に必要なエネルギーは，1 mol の水が凝固する際に放出されるエネルギーと等しい。",
                "③ C－H 結合の結合エネルギーが Q (kJ/mol) であるとき，1 mol の CH₄ 分子を C 原子と H 原子に完全に分解するには， 4Q (kJ) のエネルギーが必要である。",
                "④ 正反応が吸熱反応の場合，逆反応の活性化エネルギーは，正反応の活性化エネルギーよりも大きい。"
            ],
            correct: 3, 
            explanation: "吸熱反応＝「ゴール（生成物）が高い位置にある」。山を越えるとき、高い位置にあるゴールから戻る（逆反応）ほうが、低いスタートから登るよりも、登る距離（活性化エネルギー）は小さくなります。",
            mnemonic: "覚え方：「吸熱はゴールが高い。帰り道（逆反応）の山登りは楽ちん（小さい）」"
        },
        {
            id: 10,
            text: "α-アミノ酸およびタンパク質に関する記述として誤りを含むものはどれか。",
            options: [
                "① 天然に存在するタンパク質を構成する α-アミノ酸のうち，グリシンだけが不斉炭素原子をもたない。",
                "② タンパク質に濃い水酸化ナトリウム水溶液を加えて加熱し，酢酸で中和した後に酢酸鉛(II)水溶液を加えると，黄色沈殿が生じる。",
                "③ タンパク質水溶液に酸や塩基の水溶液を加えると，タンパク質の立体構造が変化することでタンパク質が凝固する。",
                "④ 加水分解したとき，α-アミノ酸のみを生じるタンパク質を単純タンパク質という。"
            ],
            correct: 1, 
            explanation: "硫黄の検出反応ですが、生成する硫化鉛（PbS）の沈殿の色は「黒色」です。黄色ではありません。",
            mnemonic: "覚え方：「鉛（Pb）と硫黄（S）で、腹黒（PbSは黒）になる」"
        },
        {
            id: 11,
            text: "ハロゲンの単体の反応に関する記述として誤りを含むものはどれか。",
            options: [
                "① フッ素は水と激しく反応し，酸素が発生する。",
                "② 臭素水にアセチレンを通じると，臭素水の赤褐色が脱色される。",
                "③ 塩素は水に少し溶け，その一部が水と反応して強い酸化力をもつ物質を生じる。",
                "④ 臭化カリウム水溶液にヨウ素を加えると，臭素の単体が遊離する。"
            ],
            correct: 3, 
            explanation: "ハロゲンの酸化力の強さは F > Cl > Br > I です。ヨウ素（I）は臭素（Br）より弱いため、臭素を追い出すことはできません。",
            mnemonic: "覚え方：「ヨウ素は弱虫。兄貴分の臭素には勝てない」"
        },
        {
            id: 12,
            text: "コロイドに関する記述として誤りを含むものはどれか。",
            options: [
                "① コロイド粒子が不規則に熱運動する現象を，ブラウン運動という。",
                "② コロイド溶液の横から強い光を照射すると，光の進路が輝いて見える。",
                "③ 親水コロイドに多量の電解質を加えるとコロイドが沈殿する現象を，塩析という。",
                "④ 水酸化鉄(III)のコロイド粒子の表面は正の電荷を帯びているので，電気泳動により陰極側へ移動する。",
                "⑤ 墨汁には，保護コロイドとしてニカワが加えられている。"
            ],
            correct: 0, 
            explanation: "ブラウン運動の原因は、コロイド粒子自身の熱運動ではなく、「分散媒（水分子など）が熱運動して、コロイド粒子に不規則に衝突するから」です。定義のひっかけ問題として頻出です。",
            mnemonic: "覚え方：「ブラウン運動は、見えない水分子のアタックのせい（コロイドは被害者）」"
        }
    ];

    let quizQueue = [];
    let currentStep = 0;
    let score = 0;
    let wrongAnswers = [];
    let isRetryMode = false;

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startQuiz(mode) {
        let indices = problems.map((_, index) => index);
        if (mode === 'shuffle') {
            indices = shuffleArray(indices);
        }
        quizQueue = indices;
        document.getElementById('start-screen').style.display = 'none';
        startSession();
    }

    function startSession() {
        currentStep = 0;
        score = 0;
        if (!isRetryMode) {
            wrongAnswers = [];
        }
        document.getElementById('quiz-screen').style.display = 'block';
        document.getElementById('result-screen').style.display = 'none';
        showQuestion();
    }

    function showQuestion() {
        const problemIndex = quizQueue[currentStep];
        const problem = problems[problemIndex];

        document.getElementById('quiz-header').innerText = `問題 ${currentStep + 1} / ${quizQueue.length}`;
        const progress = ((currentStep) / quizQueue.length) * 100;
        document.getElementById('progress-fill').style.width = `${progress}%`;
        document.getElementById('question-text').innerText = problem.text;
        document.getElementById('explanation-area').style.display = 'none';

        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';

        problem.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(index, problem.correct, btn);
            optionsContainer.appendChild(btn);
        });
    }

    /* =========================================
       新しいアニメーション関数
       ========================================= */
    function showFeedback(isCorrect) {
        // コンテナを作成
        const container = document.createElement('div');
        container.className = 'anim-container';
        document.body.appendChild(container);

        // シンボル（〇 or ✕）を作成
        const symbol = document.createElement('div');
        symbol.innerText = isCorrect ? '〇' : '✕';
        symbol.className = isCorrect ? 'symbol-correct' : 'symbol-wrong';
        container.appendChild(symbol);

        // 正解なら紙吹雪を生成
        if (isCorrect) {
            const colors = ['#f1c40f', '#e74c3c', '#3498db', '#9b59b6', '#2ecc71'];
            for (let i = 0; i < 40; i++) { // パーティクルの数
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // ランダムな位置から少しずらす
                const startX = (Math.random() - 0.5) * 50;
                
                // 飛び散る方向 (CSS変数で渡す)
                const moveX = (Math.random() - 0.5) * 600; // 横方向の広がり
                const moveY = (Math.random() - 1.0) * 600; // 上方向への広がり
                
                confetti.style.left = `calc(50% + ${startX}px)`;
                confetti.style.top = `60%`;
                confetti.style.setProperty('--tx', `${moveX}px`);
                confetti.style.setProperty('--ty', `${moveY}px`);
                
                // サイズや速度のランダム化
                confetti.style.animationDuration = (0.8 + Math.random() * 0.7) + 's';
                
                container.appendChild(confetti);
            }
        }

        // アニメーション終了後にDOMを削除（メモリリーク防止）
        setTimeout(() => {
            document.body.removeChild(container);
        }, 1500);
    }

    function checkAnswer(selectedIndex, correctIndex, btnElement) {
        const buttons = document.querySelectorAll('.option-btn');
        buttons.forEach(b => b.disabled = true);

        const problemIndex = quizQueue[currentStep];
        const problem = problems[problemIndex];

        if (selectedIndex === correctIndex) {
            btnElement.classList.add('correct');
            showFeedback(true); // ★正解アニメーション呼び出し
            if (!isRetryMode) score++; 
        } else {
            btnElement.classList.add('wrong');
            buttons[correctIndex].classList.add('correct');
            showFeedback(false); // ★不正解アニメーション呼び出し
            
            if (!wrongAnswers.includes(problemIndex)) {
                wrongAnswers.push(problemIndex);
            }
        }

        document.getElementById('explanation-text').innerText = problem.explanation;
        document.getElementById('mnemonic-text').innerText = problem.mnemonic;
        document.getElementById('explanation-area').style.display = 'block';
    }

    function nextQuestion() {
        currentStep++;
        if (currentStep < quizQueue.length) {
            showQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';

        const total = quizQueue.length;
        let scoreText = "";
        
        if(!isRetryMode) {
            scoreText = `${total}問中 ${score}問正解！`;
        } else {
            scoreText = `復習完了！`;
        }
        
        document.getElementById('score-display').innerText = scoreText;

        const msgElement = document.getElementById('result-message');
        const retryBtn = document.getElementById('retry-wrong-btn');

        if (wrongAnswers.length === 0) {
            if (!isRetryMode) {
                msgElement.innerText = "素晴らしい！全問正解です！";
            } else {
                msgElement.innerText = "苦手を克服しましたね！";
            }
            msgElement.style.color = "var(--success-color)";
            msgElement.style.fontWeight = "bold";
            retryBtn.style.display = 'none';
        } else {
            msgElement.innerText = isRetryMode 
                ? `まだ ${wrongAnswers.length} 問の弱点があります。完璧になるまで繰り返しましょう！`
                : `${wrongAnswers.length} 問の間違いがありました。解説を読んで復習しましょう。`;
            msgElement.style.color = "var(--text-color)";
            retryBtn.style.display = 'inline-block';
        }
    }

    function retryWrong() {
        isRetryMode = true;
        quizQueue = [...wrongAnswers];
        wrongAnswers = [];
        startSession();
    }
</script>
</body>
</html>
